<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Custo de Energia - Enel SP</title>
    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="container p-4 p-md-5">

<div class="bg-white rounded-3 shadow-lg mx-auto overflow-hidden">
    <header class="bg-primary text-white p-4">
        <h1 class="h4 fw-bold">Calculadora de Consumo El√©trico</h1>
        <p class="mb-0 small opacity-75">Calculadora aproximada de consumo energ√©tico de aparelhos (valor na conta de luz).</p>
    </header>

    <!-- Navigation Tabs -->
    <div class="d-flex border-bottom border-secondary-subtle full-width-section">
        <button id="tab1-btn" onclick="showTab('tab1')" class="tab-button flex-grow-1 p-3 text-center text-secondary active-tab border-0">
            1. Calculadora de Aparelhos
        </button>
        <button id="tab2-btn" onclick="showTab('tab2')" class="tab-button flex-grow-1 p-3 text-center text-secondary border-0">
            2. Conversor Watts ‚ûî kWh
        </button>
        <button id="tab3-btn" onclick="showTab('tab3')" class="tab-button flex-grow-1 p-3 text-center text-secondary border-0">
            3. Guia de Uso
        </button>
    </div>

    <!-- TAB 1: Monthly Consumption Calculator -->
    <div id="tab1" class="p-4 p-md-5">
        
        <!-- Tariffs and Configuration (Settings) -->
        <div class="bg-light p-4 rounded border border-primary-subtle shadow-sm mb-4">
            <h2 class="h5 fw-semibold text-primary mb-3">Configura√ß√£o de Tarifas (Seu Faturamento)</h2>
            <p class="small text-muted mb-4">Valores extra√≠dos da fatura em 10/2025.</p>
            
            <div class="row g-3 small">
                <!-- TUSD & TE Base -->
                <div class="col-12 col-md-3">
                    <label class="form-label fw-medium text-secondary">TUSD Base (R$/kWh):</label>
                    <input type="number" id="tusd-base" step="0.00001" oninput="updateTariff()" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-3">
                    <label class="form-label fw-medium text-secondary">TE Base (R$/kWh):</label>
                    <input type="number" id="te-base" step="0.00001" oninput="updateTariff()" class="form-control form-control-sm">
                </div>

                <!-- Bandeira (Dropwdown do Bootstrap - ESTILO CORRIGIDO) -->
                <div class="col-12 col-md-3">
                    <label for="bandeira-select-display" class="form-label fw-medium text-secondary">Bandeira Atual:</label>
                    
                    <div class="dropdown" id="bandeira-dropdown">
                        <!-- Bot√£o com estilo de SELECT - Fundo branco e borda sutil -->
                        <button class="btn btn-light text-dark border-secondary-subtle btn-sm w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="bandeira-select-display"
                            data-value="0.00000" data-label="Verde">
                            <!-- Conte√∫do inicial do bot√£o ser√° preenchido via JS (Verde) -->
                        </button>
                        <!-- √çcone de seta fixo -->
                        <span class="dropdown-toggle-icon">‚ñº</span>
                        
                        <ul class="dropdown-menu w-100" aria-labelledby="bandeira-select-display" id="bandeira-select-menu">
                            <li><a class="dropdown-item" href="#" data-value="0.00000" data-label="Verde" data-color="bg-success" onclick="selectBandeira(this, event)">
                                <span><span class="flag-indicator bg-success me-2"></span> Verde</span>
                            </a></li>
                            <li><a class="dropdown-item" href="#" data-value="0.02989" data-label="Amarela" data-color="bg-warning" onclick="selectBandeira(this, event)">
                                <span><span class="flag-indicator bg-warning me-2"></span> Amarela</span>
                            </a></li>
                            <li><a class="dropdown-item" href="#" data-value="0.06500" data-label="Vermelha P1" data-color="bg-danger" onclick="selectBandeira(this, event)">
                                <span><span class="flag-indicator bg-danger me-2"></span> Vermelha P1</span>
                            </a></li>
                            <li><a class="dropdown-item" href="#" data-value="0.07800" data-label="Vermelha P2" data-color="bg-danger" onclick="selectBandeira(this, event)">
                                <span><span class="flag-indicator bg-danger me-2"></span> Vermelha P2</span>
                            </a></li>
                        </ul>
                    </div>
                    <!-- Campo de Adicional -->
                    <span class="d-block text-muted mt-1" id="bandeira-info">Adicional: R$ 0,00000</span>
                </div>
                
                <!-- CIP and Impostos (NOW EDITABLE) -->
                <div class="col-12 col-md-3">
                    <label class="form-label fw-medium text-secondary">CIP (R$ fixo):</label>
                    <input type="number" id="cip-value" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-3">
                    <label class="form-label fw-medium text-secondary">ICMS (%):</label>
                    <input type="number" id="icms-rate" step="0.01" oninput="updateTariff()" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-3">
                    <label class="form-label fw-medium text-secondary">PIS/COFINS (%):</label>
                    <input type="number" id="pis-cofins-rate" step="0.01" oninput="updateTariff()" class="form-control form-control-sm">
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <p class="h6 fw-bold text-success">Custo Unit√°rio Bruto Atualizado (R$/kWh): <span id="unit-cost">R$ 1,2435</span></p>
                <p class="small text-muted">Valor que inclui TUSD, TE, Adicional Bandeira (se houver), ICMS e PIS/COFINS.</p>
            </div>
        </div>

        <!-- Data Import/Export Buttons (Customizado) -->
        <div class="bg-light p-4 rounded border border-secondary-subtle shadow-sm mb-4">
            <h3 class="h6 fw-semibold text-secondary mb-3">Configura√ß√£o de Dados (JSON)</h3>
            <div class="d-flex flex-wrap gap-3">
                
                <!-- Bot√£o 1: Download Template -->
                <button onclick="downloadTemplate()" class="btn btn-warning btn-sm flex-grow-1 fw-medium shadow-sm">
                    <span class="material-symbols-placeholder">üìÑ</span> Baixar Exemplo
                </button>

                <!-- Bot√£o 2: Upload Data -->
                <input type="file" id="file-input" accept=".json" onchange="handleFileUpload()">
                <button onclick="document.getElementById('file-input').click()" class="btn btn-secondary btn-sm flex-grow-1 fw-medium shadow-sm">
                    <span class="material-symbols-placeholder">‚¨ÜÔ∏è</span> Carregar
                </button>

                <!-- Bot√£o 3: Download Current Data -->
                <button onclick="downloadCurrentData()" class="btn btn-primary btn-sm flex-grow-1 fw-medium shadow-sm">
                    <span class="material-symbols-placeholder">‚¨áÔ∏è</span> Baixar Dados Atuais
                </button>
            </div>
        </div>
        
        <!-- Appliance List -->
        <h2 class="h5 fw-semibold text-primary">Lista de Aparelhos para C√°lculo Mensal</h2>
        
        <div class="table-responsive table-responsive-scroll">
            <table class="table table-striped table-hover small bg-white rounded-3 shadow">
                <thead class="table-primary sticky-top" style="top: -1px;">
                    <tr>
                        <th class="p-3 text-start col-aparelho">Aparelho</th>
                        <th class="p-3 text-center col-kwh-dia">Consumo (kWh/dia)</th>
                        <th class="p-3 text-center col-dias-mes">Dias/M√™s</th>
                        <th class="p-3 text-center col-kwh-mes">kWh/M√™s</th>
                        <th class="p-3 text-center col-custo">Custo (R$/M√™s)</th>
                    </tr>
                </thead>
                <tbody id="appliance-list">
                    <!-- Linhas de aparelhos ser√£o adicionadas aqui -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="5" class="p-3 text-center">
                            <button onclick="addRow()" class="btn btn-success btn-sm rounded-pill fw-medium shadow-sm">
                                <span class="material-symbols-placeholder">+</span> Adicionar Aparelho
                            </button>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>

<!-- Monthly Summary -->
<div class="d-flex justify-content-end pt-4">
    <div class="w-100 w-md-50 p-4 bg-primary-subtle rounded-3 border border-primary-light">
        
        <!-- ITEM: Consumo M√©dio por Dia (kWh/dia) -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2 fw-semibold text-secondary">
            <span>Consumo M√©dio por Dia (kWh/dia):</span>
            <span id="total-kwh-day" class="text-secondary fs-5 fw-bold text-md-end">0,00</span>
        </div>
        
        <!-- ITEM: Consumo Total Estimado (kWh) -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2 fw-semibold text-secondary">
            <span>Consumo Total Estimado (kWh):</span>
            <span id="total-kwh" class="text-secondary fs-5 fw-bold text-md-end">0,00</span>
        </div>
        
        <!-- ITEM: Custo Total dos Aparelhos (R$) -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2 fw-semibold text-secondary">
            <span>Custo Total dos Aparelhos (R$):</span>
            <span id="total-cost" class="text-primary fs-5 fw-bold text-md-end">R$ 0,00</span>
        </div>
        
        <hr class="border-primary">
        
        <!-- ITEM: Custo Total Estimado c/ CIP (R$) - Destaque Final -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center h5 fw-bold text-primary">
            <span>Custo Total Estimado c/ CIP (R$):</span>
            <span id="final-cost" class="text-primary fs-4 fw-bolder text-md-end">R$ 15,93</span>
        </div>
        
        <p class="small text-muted text-end mb-0">CIP de R$ <span id="final-cip">15.93</span> incluso no total.</p>
    </div>
</div>
    </div>

    <!-- TAB 2: Power Converter -->
    <div id="tab2" class="p-4 p-md-5 d-none">
        <h2 class="h5 fw-semibold text-primary mb-4">Conversor de Pot√™ncia (Watts ‚ûî kWh)</h2>
        <div class="row g-4 bg-light p-4 rounded border border-primary-subtle shadow-sm">
            
            <div class="col-md-6 space-y-4">
                <div class="col-12 mb-3">
                    <label for="input-watts" class="form-label fw-medium text-secondary">Pot√™ncia do Aparelho (Watts - W):</label>
                    <input type="number" id="input-watts" placeholder="Ex: 1200 (para um secador de cabelo)" oninput="calculateKwh()" class="form-control">
                    <small class="text-muted d-block mt-1">Geralmente encontrado na etiqueta ou manual do produto (Pot√™ncia em Watts).</small>
                </div>
                
                <div class="col-12 mb-3">
                    <label for="input-hours" class="form-label fw-medium text-secondary">Horas de Uso por Dia (h/dia):</label>
                    <input type="number" id="input-hours" placeholder="Ex: 0.5 (30 minutos)" oninput="calculateKwh()" class="form-control">
                </div>
                
                <div class="col-12 mb-3">
                    <label for="input-days" class="form-label fw-medium text-secondary">Dias de Uso por M√™s:</label>
                    <input type="number" id="input-days" placeholder="Ex: 30" oninput="calculateKwh()" class="form-control">
                </div>
            </div>

            <div class="col-md-6 d-flex flex-column justify-content-center align-items-center">
                <div class="bg-white p-4 rounded border border-primary-subtle shadow-sm w-100 text-center">
                    <p class="small fw-medium text-muted mb-2">Consumo Mensal Estimado:</p>
                    <p class="display-6 fw-bolder text-primary mb-1" id="output-kwh">0,000</p>
                    <p class="h5 fw-semibold text-secondary">kWh/m√™s</p>
                    
                    <!-- CAMPO: Consumo Di√°rio Estimado -->
                    <div class="mt-4 pt-4 border-top border-secondary-subtle w-100 text-center">
                        <p class="small fw-medium text-muted mb-2">Consumo Di√°rio Estimado:</p>
                        <p class="display-6 fw-bolder text-success mb-1" id="output-kwh-day">0,000</p>
                        <p class="h5 fw-semibold text-secondary">kWh/dia</p>
                    </div>
                    <!-- FIM CAMPO -->

                    
                    <div class="mt-4 pt-4 border-top border-secondary-subtle w-100 text-center">
                        <p class="small text-muted mb-1">F√≥rmula utilizada: </p>
                        <p class="small font-monospace bg-light border d-inline-block px-2 py-1 rounded">
                            (W * h/dia * dias/m√™s) / 1000
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- TAB 3: Explanation Guide (Guia de Uso) -->
    <div id="tab3" class="p-4 p-md-5 d-none">
        <h2 class="h5 fw-semibold text-primary border-bottom pb-2 mb-4">3. Guia de Uso: Entenda a Fatura e os Dados JSON</h2>
        
        <p class="mb-4">Esta guia oferece suporte para extrair os dados corretos da sua fatura e para manipular os arquivos de importa√ß√£o/exporta√ß√£o JSON.</p>
        

        <div class="accordion" id="accordionFatura">
            
            <!-- SE√á√ÉO 1: Fatura -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button fw-bold text-blue-700" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <span class="material-symbols-placeholder">üßæ</span> 1. Extraindo Valores da Fatura
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionFatura">
                    <div class="accordion-body">
                        <p class="mb-3">Voc√™ encontrar√° a maioria dos valores na se√ß√£o **'Descri√ß√£o do Faturamento'** da sua conta, na coluna **"Pre√ßo Unit. (R$/kWh)"**. </p>
                        
                        <h6 class="fw-semibold mt-3">Tarifas Base </h6>
                        <ul class="list-group list-group-flush small mb-3">
                            <li class="list-group-item">
                                <strong>TUSD (R$/kWh):</strong> Tarifa de Uso do Sistema de Distribui√ß√£o. 
                                √â o custo cobrado pela distribuidora (Enel) pelo **uso da rede** e equipamentos (postes, cabos, transformadores) que trazem a energia at√© sua casa. √â o custo do **transporte**.
                                <span class="badge text-bg-info ms-2">Linha: USO SIST. DISTR. (TUSD)</span>
                            </li>
                            <li class="list-group-item">
                                <strong>TE (R$/kWh):</strong> Tarifa de Energia.
                                √â o custo referente ao **insumo energia** em si, ou seja, o valor que voc√™ paga pelo kWh gerado nas usinas. √â o custo da **compra da energia**.
                                <span class="badge text-bg-info ms-2">Linha: ENERGIA (TE)</span>
                            </li>
                        </ul>
                        
                        <h6 class="fw-semibold mt-3">Adicional Bandeira üö¶</h6>
                        <p class="small">Valor adicional por kWh na linha **ADIC BANDEIRA [Cor]**. √â um custo extra determinado pela ANEEL, refletindo o custo de gera√ß√£o de energia no pa√≠s. Escolha a bandeira vigente no seletor da Aba 1.</p>
                        
                        <!-- TABELA DE BANDEIRAS -->
                        <div class="table-responsive mb-3">
                            <table class="table table-sm table-striped small">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Bandeira</th>
                                        <th>Condi√ß√£o e Acr√©scimo (ANEEL)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Bandeira Verde</td>
                                        <td>Condi√ß√µes favor√°veis de gera√ß√£o. Sem acr√©scimo na tarifa.</td>
                                    </tr>
                                    <tr>
                                        <td>Bandeira Amarela</td>
                                        <td>Gera√ß√£o menos favor√°vel. Acr√©scimo de R$ 0,01885 por kWh consumido.</td>
                                    </tr>
                                    <tr>
                                        <td>Bandeira Vermelha - Patamar 1</td>
                                        <td>Gera√ß√£o mais custosa. Acr√©scimo de R$ 0,04463 por kWh consumido.</td>
                                    </tr>
                                    <tr>
                                        <td>Bandeira Vermelha - Patamar 2</td>
                                        <td>Gera√ß√£o ainda mais custosa. Acr√©scimo de R$ 0,07877 por kWh consumido.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="small">Para mais detalhes sobre as bandeiras, consulte a documenta√ß√£o oficial da Enel: <a href="https://www.enel.com.br/pt-saopaulo/midia/news/d2025-7/bandeira-tarifaria-sobe-para-vermelha-patamar-2-em-agosto.html" target="_blank">Documenta√ß√£o Oficial da Enel sobre Bandeiras Tarif√°rias</a></p>
                        <!-- FIM TABELA E LINK -->
                        
                        <h6 class="fw-semibold mt-3">Impostos (%)</h6>
                        <ul class="list-group list-group-flush small mb-3">
                            <li class="list-group-item">
                                <strong>ICMS:</strong> Imposto Estadual. A al√≠quota √© encontrada na coluna **Al√≠quota (%)**. Varia conforme o consumo total da resid√™ncia (ex: 18% para consumo acima de 200 kWh).
                            </li>
                            <li class="list-group-item">
                                <strong>PIS/COFINS:</strong> Impostos Federais. Use a al√≠quota efetiva combinada mostrada na coluna **Al√≠quota (%)**.
                            </li>
                        </ul>

                         <h6 class="fw-semibold mt-3">CIP (R$ Fixo) üèôÔ∏è</h6>
                        <p class="small">A Contribui√ß√£o de Ilumina√ß√£o P√∫blica (CIP) √© um valor fixo da prefeitura, encontrado na linha **CIP - [SEU MUNIC√çPIO]** e adicionado no total final da sua conta. Deve ser inserido no campo "CIP (R$ fixo)".</p>
                    </div>
                </div>
            </div>
            
            <!-- SE√á√ÉO 2: JSON (FINALIZADA) -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                    <button class="accordion-button collapsed fw-bold text-blue-700" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        <span class="material-symbols-placeholder">‚öôÔ∏è</span> 2. Estrutura do Arquivo JSON (Importa√ß√£o/Exporta√ß√£o)
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionFatura">
                    <div class="accordion-body">
                        <p>O arquivo JSON armazena todas as suas configura√ß√µes em um formato leg√≠vel por m√°quina, dividido em duas chaves principais:</p>

                        <dl class="row mb-3">
                            <dt class="col-sm-3 text-secondary"><code class="text-danger">"tarifas"</code></dt>
                            <dd class="col-sm-9">Cont√©m todos os valores fixos (TUSD, TE, Impostos, CIP e Bandeira) que voc√™ edita na Aba 1.</dd>
                            
                            <dt class="col-sm-3 text-secondary"><code class="text-danger">"aparelhos"</code></dt>
                            <dd class="col-sm-9">√â um array (lista) de objetos, onde cada objeto √© um aparelho da sua lista de consumo.</dd>
                        </dl>

                        <h6 class="mt-4 fw-bold">Exemplo da Estrutura <code class="text-danger">"tarifas"</code>:</h6>
                        <pre class="bg-light p-2 rounded small"><code>{
  "tusd_base": 0.56068,
  "te_base": 0.37950,
  "bandeira": "Vermelha P2", 
  "cip_value": 15.93,
  "icms_rate": 18,
  "pis_cofins_rate": 5.96
}</code></pre>

                        <ul class="list-unstyled small">
                            <li><span class="material-symbols-placeholder">üìà</span> <strong>"tusd_base":</strong> Valor da Tarifa de Uso do Sistema de Distribui√ß√£o (R$/kWh).</li>
                            <li><span class="material-symbols-placeholder">‚ö°</span> <strong>"te_base":</strong> Valor da Tarifa de Energia (R$/kWh).</li>
                            <li><span class="material-symbols-placeholder">üö©</span> <strong>"bandeira":</strong> Nome da bandeira tarif√°ria (Ex: "Verde", "Amarela", "Vermelha P2").</li>
                            <li><span class="material-symbols-placeholder">üí°</span> <strong>"cip_value":</strong> Valor fixo da Contribui√ß√£o de Ilumina√ß√£o P√∫blica (R$).</li>
                            <li><span class="material-symbols-placeholder">üí∞</span> <strong>"icms_rate":</strong> Al√≠quota do ICMS (Imposto Estadual) em porcentagem (Ex: 18).</li>
                            <li><span class="material-symbols-placeholder">üí∞</span> <strong>"pis_cofins_rate":</strong> Al√≠quota combinada de PIS/COFINS (Impostos Federais) em porcentagem (Ex: 5.96).</li>
                        </ul>
                        
                        <h6 class="mt-4 fw-bold">Exemplo de um Item em <code class="text-danger">"aparelhos"</code>: </h6>
                        <pre class="bg-light p-2 rounded small"><code>{
  "nome": "Chuveiro El√©trico",
  "kwh_dia": 5.0,
  "dias_mes": 25
}</code></pre>
                        <ul class="list-unstyled small">
                            <li><span class="material-symbols-placeholder">üè∑Ô∏è</span> <strong>"nome":</strong> O nome descritivo do seu aparelho.</li>
                            <li><span class="material-symbols-placeholder">‚ö°</span> <strong>"kwh_dia":</strong> O consumo di√°rio (kWh) do aparelho.</li>
                            <li><span class="material-symbols-placeholder">üìÖ</span> <strong>"dias_mes":</strong> O n√∫mero de dias no m√™s que o aparelho √© utilizado.</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>

<!-- JavaScript Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<!-- Custom JavaScript -->
<script src="script.js"></script>
</body>
</html>